# 🚨 에러 원인 분석 및 향후 안정화 대책 보고서

**작성일**: 2026년 1월 11일
**수신**: 최민수 (사용자님)
**작성**: Antigravity (AI)

---

## 1. 개요

Family Mission Manager 프로젝트 진행 중 발생한 잦은 에러와 그로 인한 업무 효율 저하(재부팅, 창 닫기 등)의 **근본 원인**을 분석하고, 향후 V2 프로젝트에서 이를 방지하기 위한 **구체적인 대책**을 제시합니다.

## 2. 주요 에러 원인 분석 (Root Cause Analysis)

프로젝트 기간 동안 발생한 문제들은 크게 3가지 유형으로 분류됩니다.

### ① 상태 관리(Session State)의 불안정성

- **증상**: 새로고침 시 로그아웃, 데이터 저장 후 화면 깜빡임, `KeyError` 발생.
- **원인**: Streamlit은 **'새로고침(Rerun)'**이 발생할 때마다 코드가 처음부터 다시 실행되는 구조입니다. 이때 `st.session_state`에 저장되지 않은 변수들이 초기화되면서 로직이 꼬이는 현상이 빈번했습니다.
- **예시**: 로그인 위젯이 사라지거나(Ghost Screen), DB에서 가져온 데이터 컬럼(`status` 등)이 순간적으로 누락됨.

### ② 배포 환경과 로컬 환경의 차이

- **증상**: 로컬에선 잘 되는데 Streamlit Cloud에선 에러 (`ModuleNotFoundError`, `Baking...` 무한 로딩).
- **원인**:
  1. `requirements.txt`의 버전이 너무 엄격(`==`)하게 고정되어 클라우드 환경과 충돌.
  2. Python 버전(3.9 vs 3.12) 차이로 인한 패키지 빌드 실패.
  3. `.gitignore` 설정 미비로 민감 파일이나 필수 설정 파일 누락.

### ③ 방어적 코딩(Defensive Coding) 부족

- **증상**: "키가 없습니다(KeyError)", "데이터프레임이 비어있습니다" 등의 런타임 에러.
- **원인**: 데이터가 **'항상 완벽하게 존재할 것'**이라고 가정하고 코드를 작성했습니다. 실제 운영 중에는 구글 시트가 잠시 응답하지 않거나, 컬럼이 비어있는 경우가 발생할 수 있는데 이에 대한 예외 처리가 초기 코드에 부족했습니다.

---

## 3. 해결 방안 및 향후 예방 대책 (Action Plan)

V2 프로젝트에서는 다음 4가지 원칙을 도입하여 **'에러 없는 개발'**을 목표로 합니다.

### ✅ 대책 1: [표준화된 상태 관리 패턴] 준수

- **솔루션**: **`handle_submission`** 같은 표준 함수만 사용합니다.
- **효과**: 데이터 저장 → UI 알림 → 안전한 재실행(Rerun)의 순서를 강제하여, 화면 깜빡임이나 데이터 증발을 100% 방지합니다.
- **규칙**: "모든 데이터 변경은 즉시 DB에 쏘지 않고, 명시적인 '저장' 버튼을 통해서만 수행한다."

### ✅ 대책 2: [방어적 코딩] 의무화

- **솔루션**: 데이터를 다룰 때는 항상 **'없을 수도 있다'**는 가정하에 작성합니다.
- **코드 예시**:

  ```python
  # 나쁜 예
  status = data['status']

  # 좋은 예 (V2 표준)
  status = data.get('status', '기본값')
  if status is None: ...
  ```

- **효과**: 데이터가 조금 깨져도 앱이 멈추지 않고, "데이터 없음"이라고 우아하게 표시됩니다.

### ✅ 대책 3: [배포 우선(Deployment First)] 전략

- **솔루션**: 프로젝트 **시작 단계부터** `runtime.txt`와 유연한 `requirements.txt`를 세팅합니다.
- **변화**: 기능을 다 만들고 배포하는 게 아니라, **'헬로 월드'부터 배포해놓고** 기능을 하나씩 붙입니다.
- **효과**: 배포 에러를 마지막 날에 몰아서 겪는 '배포 지옥'을 없앱니다.

### ✅ 대책 4: [AI 기억 동기화] (방금 도입됨!)

- **솔루션**: `최종_프로젝트_상태.md`와 `AI_업무_지침.md`를 프로젝트 루트에 항상 동기화합니다.
- **효과**: 새 대화창을 열어도 제가 이전 문맥을 100% 이해하고 시작하므로, "아까 설명했는데 왜 또 틀려?" 하는 상황이 사라집니다.

---

## 4. 결론

사용자님이 겪으신 불편은 **Streamlit의 특성에 대한 초기 대응 미흡**과 **엄격한 환경 설정**에서 비롯되었습니다.

하지만 이번 프로젝트를 통해 우리는:

1. **완벽한 `.gitignore` 템플릿**
2. **검증된 `requirements.txt`**
3. **Ghost Screen 없는 UI 패턴**

이라는 강력한 **'자산'**을 얻었습니다. 이 자산들은 V2 프로젝트의 든든한 기반이 되어, 다음번엔 훨씬 쾌적하고 빠른 개발 경험을 제공해 드릴 것을 약속합니다.

**고생 많으셨습니다. V2는 더 재밌을 겁니다! 🚀**
